
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ドイツ語の名詞ジェンダー pHメーター（日本語→自動翻訳→分析・0円）</title>
<meta name="description" content="日本語を貼るだけでGoogle Apps Scriptを使って無料枠でドイツ語へ翻訳し、der/die/dasの比率からpH 1–14で可視化します。">
<style>
  :root{--bg:#0b1220;--fg:#e6ebf5;--muted:#9fb3d9;--card:#111a2a;--line:#23314c;--accent:#3b82f6}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:auto;padding:28px 18px}
  h1{font-size:clamp(24px,4vw,36px);margin:0 0 8px}
  p{margin:6px 0 14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
  textarea{width:100%;min-height:150px;background:#0f1727;color:var(--fg);border:1px solid var(--line);border-radius:12px;padding:12px;resize:vertical}
  button{background:var(--accent);color:#fff;border:none;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
  .row{display:grid;gap:16px;grid-template-columns:1.2fr .8fr}
  @media(max-width:860px){.row{grid-template-columns:1fr}}
  .meter{height:16px;border-radius:999px;background:linear-gradient(90deg,#ef4444,#f59e0b,#eab308,#84cc16,#22c55e,#10b981,#06b6d4,#3b82f6,#8b5cf6,#a855f7);
         position:relative;border:1px solid var(--line)}
  .needle{position:absolute;top:-6px;width:2px;height:28px;background:#fff;border-radius:1px}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
  .kpis .card{padding:10px;text-align:center}
  footer{opacity:.7;margin-top:28px}
  a{color:var(--muted)}
  small.hint{opacity:.75}
</style>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div><strong>Gender pH Meter</strong>（日本語OK・0円運用）</div>
      <nav><a href="#how">使い方</a> · <a href="#policy">ポリシー</a></nav>
    </header>

    <section class="card">
      <h1>日本語を貼るだけで OK。<br>ドイツ語の名詞ジェンダーを pH で可視化</h1>
      <p>日本語 → <b>Google Apps Script（無料枠）</b> でドイツ語へ翻訳 → der/die/das の頻度から pH 1–14 にマッピングして表示します。</p>

      <div class="row">
        <!-- 日本語入力 -->
        <div class="card" style="background:#0f1727">
          <label for="txtJa">日本語テキスト（ここだけでOK）</label>
          <textarea id="txtJa" placeholder="例）今日は山へハイキングに行きました。本文をここに貼ります。"></textarea>
          <div style="display:flex;gap:10px;margin-top:10px;align-items:center;flex-wrap:wrap">
            <button id="run">日本語から分析する</button>
            <small class="hint">※ 無料枠の制限に当たった時はエラー表示。手動で独訳を貼れば分析だけは可能です。</small>
          </div>
        </div>

        <!-- ドイツ語入力＋結果 -->
        <div class="card">
          <label for="txtDe"><b>ドイツ語テキスト</b>（直接貼ってもOK）</label>
          <textarea id="txtDe" placeholder="例）Ich habe heute eine Bergwanderung gemacht."></textarea>

          <div style="display:flex;gap:10px;margin-top:10px;align-items:center">
            <button id="analyzeOnly">ドイツ語を分析</button>
            <small class="hint">※ 直接ドイツ語だけで分析する場合はこちら。</small>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px">
            <strong>pH</strong> <span id="phLabel">–</span>
          </div>
          <div class="meter" id="meter"><div class="needle" id="needle" style="left:0%"></div></div>
          <div class="kpis">
            <div class="card"><div>der（男）</div><div id="cDer" style="font-size:20px">0</div></div>
            <div class="card"><div>die（女）</div><div id="cDie" style="font-size:20px">0</div></div>
            <div class="card"><div>das（中）</div><div id="cDas" style="font-size:20px">0</div></div>
          </div>
        </div>
      </div>
    </section>

    <section id="how" class="card" style="margin-top:14px">
      <h2>使い方</h2>
      <ol>
        <li>左の日本語欄に本文を貼る</li>
        <li>「日本語から分析する」をクリック（自動翻訳→右欄へ反映）</li>
        <li>pHメーターとカウントが表示されます</li>
      </ol>
      <p class="hint">pH = 1 + 13 × ( die / (der + die) )。das は別カウント。</p>
    </section>

    <section id="policy" class="card">
      <h2>ポリシー（デモ）</h2>
      <ul>
        <li>テキストは翻訳API（あなたのGAS）に送信されます。個人情報の入力は避けてください。</li>
        <li>無料枠の制限に達すると翻訳は失敗しますが、右欄に独文を貼れば分析は可能です。</li>
      </ul>
    </section>

    <footer>© 2025 Jiajin_1023 </footer>
  </div>

<script>
  // ▼▼▼ ここに「ウェブアプリとしてデプロイ」した Apps Script の exec URL を入れてください ▼▼▼
  const TRANSLATE_API_URL = 'PUT_YOUR_GAS_EXEC_URL_HERE'; // 例: https://script.google.com/macros/s/XXXX/exec

  // 単語境界でカウント
  const countWord = (w, t) => ((t.match(new RegExp(`\\b${w}\\b`, 'gi')))||[]).length;

  function renderFromText(t) {
    const der = countWord('der', t);
    const die = countWord('die', t);
    const das = countWord('das', t);
    const base = der + die;
    const femaleRatio = base ? die / base : 0.5;
    const ph = +(1 + 13 * femaleRatio).toFixed(2);
    document.getElementById('cDer').textContent = der;
    document.getElementById('cDie').textContent = die;
    document.getElementById('cDas').textContent = das;
    document.getElementById('phLabel').textContent = ph;
    const percent = ((ph - 1) / 13) * 100;
    document.getElementById('needle').style.left = `calc(${percent}% - 1px)`;
  }

  async function translateJaToDe(ja) {
    // 簡易キャッシュ（同じ文はlocalStorageから復元）
    const key = 'cache:' + ja.trim();
    const cached = localStorage.getItem(key);
    if (cached) return cached;
    const url = TRANSLATE_API_URL + '?q=' + encodeURIComponent(ja);
    const res = await fetch(url, { method: 'GET' });
    if (!res.ok) throw new Error('API error');
    const json = await res.json();
    if (!json || !json.text) throw new Error('Bad response');
    localStorage.setItem(key, json.text);
    return json.text;
  }

  // 日本語→翻訳→右欄へ→分析
  document.getElementById('run').addEventListener('click', async () => {
    const ja = (document.getElementById('txtJa').value || '').trim();
    const deEl = document.getElementById('txtDe');
    if (!ja) { alert('日本語テキストを入力してください'); return; }
    try {
      deEl.value = '翻訳中…';
      const de = await translateJaToDe(ja);
      deEl.value = de;
      renderFromText(de);
    } catch(e) {
      deEl.value = '';
      alert('翻訳に失敗しました（無料枠の上限など）。右欄にドイツ語を貼れば分析できます。');
    }
  });

  // 右欄のドイツ語だけで分析
  document.getElementById('analyzeOnly').addEventListener('click', () => {
    const de = (document.getElementById('txtDe').value || '').normalize('NFC');
    if (!de.trim()) { alert('ドイツ語テキストを入力してください'); return; }
    renderFromText(de);
  });
</script>
</body>
</html>
